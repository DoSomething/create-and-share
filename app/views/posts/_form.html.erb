<%= form_for @post, :html => { :multipart => true } do |f| %>
  <% if @post.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@post.errors.count, "error") %> prohibited this post from being saved:</h2>

      <ul>
      <% @post.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :image %><br />
    <%= f.file_field :image %>
  </div>
  <div class="field">
    <%= f.label :top_text %><br />
    <%= f.text_field :top_text %>
  </div>
  <div class="field">
    <%= f.label :bottom_text %><br />
    <%= f.text_field :bottom_text %>
  </div>
  <div style="position: relative; display: block; width: 450px; height: 450px; border: 1px solid #000" id="upload-box">
    <div id="top_text" style="visibility: hidden; position: absolute; z-index: 1; padding: 5px; background: rgba(0,0,0,0.25); display: block;width: 100%; box-sizing: border-box;"></div>
    <span>Upload an image and it will appear here.</span>
    <div id="bottom_text" style="visibility: hidden; position: absolute; z-index: 1; padding: 5px; background: rgba(0,0,0,0.25); display: block;width: 100%; box-sizing: border-box;"></div>
  </div>
  <div class="field">
    <%= f.label :name %><br />
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :animal_type %><br />
    <%= f.select :animal_type, [['Cat', 'cat'], ['Dog', 'dog'], ['Other', 'other']] %>
  </div>
  <div class="field">
    <%= f.label :state %><br />
    <%= f.select :state, [['Alabama', 'AL'], ['Alaska', 'AK'], ['American Samoa', 'AS'], ['Arizona', 'AZ'], ['Arkansas', 'AR'], ['California', 'CA'], ['Colorado', 'CO'], ['Connecticut', 'CT'], ['Delaware', 'DE'], ['District of Columbia', 'DC'], ['Florida', 'FL'], ['Georgia', 'GA'], ['Guam', 'GU'], ['Hawaii', 'HI'], ['Idaho', 'ID'], ['Illinois', 'IL'], ['Indiana', 'IN'], ['Iowa', 'IA'], ['Kansas', 'KS'], ['Kentucky', 'KY'], ['Louisiana', 'LA'], ['Maine', 'ME'], ['Marshall Islands', 'MH'], ['Maryland', 'MD'], ['Massachusetts', 'MA'], ['Michigan', 'MI'], ['Minnesota', 'MN'], ['Mississippi', 'MS'], ['Missouri', 'MO'], ['Montana', 'MT'], ['Nebraska', 'NE'], ['Nevada', 'NV'], ['New Hampshire', 'NH'], ['New Jersey', 'NJ'], ['New Mexico', 'NM'], ['New York', 'NY'], ['North Carolina', 'NC'], ['North Dakota', 'ND'], ['Northern Marianas Islands', 'MP'], ['Ohio', 'OH'], ['Oklahoma', 'OK'], ['Oregon', 'OR'], ['Palau', 'PW'], ['Pennsylvania', 'PA'], ['Puerto Rico', 'PR'], ['Rhode Island', 'RI'], ['South Carolina', 'SC'], ['South Dakota', 'SD'], ['Tennessee', 'TN'], ['Texas', 'TX'], ['Utah', 'UT'], ['Vermont', 'VT'], ['Virgin Islands', 'VI'], ['Virginia', 'VA'], ['Washington', 'WA'], ['West Virginia', 'WV'], ['Wisconsin', 'WI'], ['Wyoming', 'WY']] %>
  </div>
  <div class="field">
    <%= f.label :shelter %><br />
    <%= f.text_field :shelter %>
  </div>
  <div class="field">
    <%= f.label :flagged %><br />
    <%= f.check_box :flagged %>
  </div>
  <div class="field">
    <%= f.label :promoted %><br />
    <%= f.check_box :promoted %>
  </div>
  <div class="field">
    <%= f.label :share_count %><br />
    <%= f.number_field :share_count %>
  </div>
  <div class="field">
    <%= f.label :story %><br />
    <%= f.text_area :story %>
  </div>
  <div class="field">
    <%= f.label :creation_time %><br />
    <%= f.datetime_select :creation_time %>
  </div>
  <div class="field">
    <%= f.label :update_time %><br />
    <%= f.datetime_select :update_time %>
  </div>
  <div class="field">
    <%= f.label :adopted %><br />
    <%= f.check_box :adopted %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<script type="text/javascript">
<!-- 
  function handle_text_change(field, elm) {
    $('#' + field).data('val',  $('#' + field).val() ); // save value
    $('#' + field).change(function() { // works when input will be blured and the value was changed
      $('#' + elm).text($(this).val());
    });
    $('#' + field).keyup(function() { // works immediately when user press button inside of the input
      if( $('#' + field).val() != $('#' + field).data('val') ){ // check if value changed
        $('#' + field).data('val',  $('#' + field).val() ); // save new value
        if ($('#' + field).val() != "") {
          if ($('#' + elm).css('visibility') != "visible") {
            $('#' + elm).css('visibility', 'visible');
          }
        }
        else {
          $('#' + elm).css('visibility', 'hidden');
        }

        $(this).change(); // simulate "change" event
      }
    });
  }

  $('#post_image').change(function() {
    var file_data = $("#post_image").prop("files")[0];   // Getting the properties of file from file field
    var form_data = new FormData();                  // Creating object of FormData class
    form_data.append("file", file_data)              // Appending parameter named file with properties of file_field to form_data
    $.ajax({
        url: "/autoimg",
        dataType: 'script',
        cache: false,
        contentType: false,
        processData: false,
        data: form_data,                         // Setting the data attribute of ajax with file_data
        type: 'post',
        complete: function(response) {
          res = $.parseJSON(response.responseText);
          if (res.success === true) {
            change_upload(res.filename);
          }
        }

    });
  })

  function change_upload(filename) {
    $('#upload-box').find('span').hide();
    var img = $('<img />');
    img.attr('src', '/system/tmp/' + filename);
    img.css({ 'width': '450px', 'height': '450px', 'position': 'absolute', 'z-index': 0 });
    img.appendTo('#upload-box');

    handle_text_change('post_top_text', 'top_text');
    handle_text_change('post_bottom_text', 'bottom_text');
  }
-->
</script>